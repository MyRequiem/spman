#! /usr/bin/env python3
# -*- coding: utf-8 -*-

# main.py file is part of spman

# Copyright 2016 MyRequiem <mrvladislavovich@gmail.com>
# All rights reserved

# spman - Slackware package manager
# Home page: https://github.com/MyRequiem/spman

# Spman is free software: you can redistribute it and/or modify
# it under the terms of the GNU General Public License as published by
# the Free Software Foundation, either version 3 of the License, or
# (at your option) any later version.
# This program is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
# GNU General Public License for more details.
# You should have received a copy of the GNU General Public License
# along with this program. If not, see <http://www.gnu.org/licenses/>.

"""
main.py
"""

import sys

from spman.checkexistsmaindirs import check_exists_main_dirs
from spman.helpmess import show_help_mess
from spman.maindata import MainData
from spman.repolist import show_repo_list
from spman.update import Update


class Main(object):
    """
    class Main
    """
    def __init__(self):
        # list of arguments
        # delete argument[0] (path and name of the script)
        self.args = sys.argv[1:]
        self.maindata = MainData()
        self.commands = {
            '-h': self.show_help,
            '--help': self.show_help,
            '-r': self.show_repo_list,
            '--repolist': self.show_repo_list,
            '-u': self.update,
            '--update': self.update
        }

    def start(self):
        """
        parse arguments and launch of the relevant options
        """
        # program is run without arguments
        if not len(self.args):
            show_help_mess('error')

        if self.args[0] in self.commands:
            # check exists dirs from /etc/spman/spman.conf
            args = ['-h', '--help', '-u', '--update']
            if len(self.args) != 1 or self.args[0] not in args:
                check_exists_main_dirs()

            # run command
            self.commands[self.args[0]]()
        else:
            show_help_mess('error')

    def show_help(self):
        """
        show help message
        """
        if len(self.args) == 1:
            show_help_mess()
        else:
            show_help_mess('error')

    def show_repo_list(self):
        """
        show repo list from /etc/spman/repo-list
        """
        if len(self.args) != 1:
            show_help_mess('error')

        show_repo_list()

    def update(self):
        """
        Update PACKAGES.TXT, SLACKBUILDS.TXT and
        ChangeLog.txt for each repository
        """
        if len(self.args) != 1:
            show_help_mess('error')

        Update().start()
